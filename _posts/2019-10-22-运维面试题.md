---
layout:     post
title:      运维面试题
subtitle:   
date:       2019-10-22
author:     墨晴
header-img: img/post-bg-map.jpg
catalog: true
tags:
    - 面试
---
### 运维面试题
#### 1.从输入www.baidu.com到展现到浏览器，经过哪些过程？

```
环节如下：
DNS寻址 --> 负载均衡 --> 建立链接 --> 发送请求 --> 服务器处理并回传 --> 浏览器接受并渲染 --> 释放链接
```
详述：
1.DNS寻址
首先寻找域名对应的IP,为提高效率，DNS解析是有层次的，具体的原则就是就近原则。浏览器首先去浏览器缓存里找，如果没有,会从hosts文件中寻找对应的IP地址，如果找到了，就是用该IP;如果找不到，便会到主机所连网络的高速缓存中去寻找;如果还是没找到。这个时候便会通过递归查询的方式到本地域名服务器去查询，如果本地域名服务器中有该url地址对应的IP地址便将其返回给主机；反之，就会采用迭代查询的方式代替主机去询问根域名服务器，如果根域名服务器也不知道，它就会告诉本地域名服务器，接下来该去哪台顶级域名服务器查询，如果该顶级域名服务器也不知道，就会告诉本地域名服务器接下来改去哪台权限域名服务器查询，等等..知道查询到该url对应的IPD地址，本地域名服务器拿到该IP地址，首先会自己缓存一份，然后告诉浏览器。
2.负载均衡
一般通过DNS解析拿到的是公网IP。一般互联网企业为了高并发高可用，会使用四层/七层负载均衡集群。请求经过四层、七层负载均衡算法被分配到真实提供服务的后端服务器上。

3.建立链接
找到目标服务器后，需要先将数据的传输通道建立起来，TCP三次握手：
第一次握手：客户端发送syn包(seq=x)到服务器，并进入SYN_SEND状态，等待服务器确认;

第二次握手：服务器收到syn包，必须确认客户的SYN(ack=x+1)，同时自己也发送一个SYN包(seq=y)，即SYN+ACK包，此时服务器进入SYN_RECV状态;

第三次握手：客户端收到服务器的SYN+ACK包，向服务器发送确认包ACK(ack=y+1)，此包发送完毕，客户端和服务器进入ESTABLISHED状态，完成三次握手。
![](https://raw.githubusercontent.com/mushroom5/mushroom5.github.io/master/img/TCP%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B.jpg)
4.发送请求
建立起连接之后，浏览器-服务器双方就可以开始传输数据了。首先，在请求报文中，需明确请求的端口，然后浏览器向服务器发送请求。从应用层开始，消息以HTTP请求报文的形式在传输层、网络层、数据链路层逐层打上头部，进行传输。在服务器端接受数据的时候，再逐层解套，最终接收到HTTP协议的请求报文，保证请求报文正确完整的被服务器端接收。
5.处理并回传
服务器端接收到请求报文，就会根据请求报文提供的要求，比如端口，参数之类的，去执行响应的操作，并将执行结果以响应报文的形式回传给浏览器。至于这个响应的操作，如果请求的是静态资源，现成的，那就直接回传，如果请求的资源需要动态生成，则web服务器就会调用不同的程序和调用数据库生成最终的HTML文件，再回传给浏览器。
6.浏览器接受并渲染
同样经过层层的增加头部和去除头部，浏览器最终得到服务器返回的HTML数据，这个时候浏览器就会加载数据，根据内容开始渲染页面，数据加载完成就会触发onload的事件。

浏览器会根据响应的内容，来处理响应。如果响应可缓存，浏览器将把响应存入缓存。

需要注意的时候，第一次浏览器获得的是HTML文件，但是HTML文件如果继续有新资源的请求，那么就会建立新的连接，跟刚刚的过程一样。比如外部的css,js，图片等文件。

 现代浏览器渲染页面的过程是这样的：jiexiHTML以构建DOM树 –> 构建渲染树 –> 布局渲染树 –> 绘制渲染树
 
 DOM树是由HTML文件中的标签排列组成，渲染树是在DOM树中加入CSS或HTML中的style样式而形成。渲染树只包含需要显示在页面中的DOM元素，像<head>元素或display属性值为none的元素都不在渲染树中。

   在浏览器还没接收到完整的HTML文件时，它就开始渲染页面了，在遇到外部链入的脚本标签或样式标签或图片时，会再次发送HTTP请求重复上述的步骤。在收到CSS文件后会对已经渲染的页面重新渲染，加入它们应有的样式，图片文件加载完立刻显示在相应位置。在这一过程中可能会触发页面的重绘或重排。
   
7.释放链接
TCP连接是无状态的，不会永久保存这个状态，所以双方完成一次数据的传输之后，如果没有持续的请求，那就要释放连接。
TCP连接的释放需要四次挥手。客户端和服务器端任意一方发起关闭请求。之所以要四次握手，还是要确认双方都确实完成各自的工作，防止有文件还没传完就断开的连接。


